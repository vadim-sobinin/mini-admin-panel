(()=>{"use strict";const e=e=>{const t=document.querySelector("#table-body");t.innerHTML="",e.forEach((e=>{const r=t.childElementCount+1,s=document.createElement("tr");s.setAttribute("id",e.id),s.innerHTML=`\n      <th scope="row">${r}</th>\n      <td>${e.name}</td>\n      <td>${e.email}</td>\n      <td>${e.children?"YES":"NO"}</td>\n      <td>\n        <div class="form-check form-switch">\n          <input\n            class="form-check-input"\n            type="checkbox"\n            role="switch"\n            id="form-permission"\n          />\n        </div>\n      </td>\n      <td>\n        <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n          <button type="button" class="btn btn-warning" id="edit-btn">\n            <i class="bi-pencil-square"></i>\n          </button>\n          <button type="button" class="btn btn-danger" id="remove-btn">\n            <i class="bi-person-x"></i>\n          </button>\n        </div>\n      </td>`,s.querySelector("#form-permission").checked=e.permission,t.append(s)}))};window.userServices=new class{getUsers(){return fetch("http://localhost:4545/users").then((e=>e.json()))}addUser(e){return fetch("http://localhost:4545/users",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((e=>e.json))}removeUser(e){return fetch(`http://localhost:4545/users/${e}`,{method:"DELETE"}).then((e=>e.json))}editUser(e,t){return fetch(`http://localhost:4545/users/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((e=>e.json))}editPermission(e,t){return fetch(`http://localhost:4545/users/${e}`,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((e=>e.json))}filterUsers(e){return fetch(`http://localhost:4545/users${e}`).then((e=>e.json()))}sortUsers(e){return fetch(`http://localhost:4545/users${e}`).then((e=>e.json()))}searchUsers(e){return fetch(`http://localhost:4545/users?name_like=${e}`).then((e=>e.json()))}},userServices.getUsers().then((t=>{e(t)})),(()=>{const t=document.querySelector("form");t.addEventListener("submit",(r=>{if(r.preventDefault(),!t.querySelector(".btn-save").hasAttribute("id")){const r={name:t.querySelector("#form-name").value,email:t.querySelector("#form-email").value,children:t.querySelector("#form-children").checked,permission:!1};userServices.addUser(r).then((()=>{userServices.getUsers().then((t=>e(t))).then((()=>(t.querySelector("#form-name").value="",t.querySelector("#form-email").value="",void(t.querySelector("#form-children").checked=!1))))}))}}))})(),document.querySelector("#table-body").addEventListener("click",(t=>{if(t.target.closest("#remove-btn")){const r=t.target.closest("tr").getAttribute("id");userServices.removeUser(r).then((()=>{userServices.getUsers().then((t=>e(t)))}))}})),(()=>{const t=document.querySelector("#table-body"),r=document.querySelector("form"),s=r.querySelector("#form-name"),n=r.querySelector("#form-email"),c=r.querySelector("#form-children");t.addEventListener("click",(t=>{if(t.target.closest("#edit-btn")){const o=t.target.closest("tr").getAttribute("id"),i=t.target.closest("tr").children;s.value=i[1].textContent,n.value=i[2].textContent,c.checked="YES"==i[3].textContent;const l=r.querySelector(".btn-save");l.setAttribute("id",`save${o}`),l.classList.replace("btn-success","btn-warning"),l.textContent="Save changes",l.addEventListener("click",(t=>{if(r.querySelector(".btn-save").hasAttribute("id")){const t={name:r.querySelector("#form-name").value,email:r.querySelector("#form-email").value,children:r.querySelector("#form-children").checked,permission:i[4].querySelector("#form-permission").checked};userServices.editUser(o,t).then((()=>{userServices.getUsers().then((t=>e(t))).then((()=>(()=>{s.value="",n.value="",c.checked=!1;const e=r.querySelector(".btn-save");e.removeAttribute("id"),e.classList.replace("btn-warning","btn-success"),e.textContent="Save"})()))}))}}))}}))})(),document.querySelector("#table-body").addEventListener("click",(t=>{if(t.target.closest("#form-permission")){const r=t.target.closest("tr").getAttribute("id"),s={permission:t.target.checked};userServices.editPermission(r,s).then((()=>{userServices.getUsers().then((t=>setTimeout(e,200,t)))}))}})),(()=>{const t=document.querySelector("#btn-isChildren"),r=document.querySelector("#btn-isPermissions"),s=document.querySelector("#btn-isAll");t.addEventListener("click",(()=>{userServices.filterUsers("?children=true").then((t=>e(t)))})),r.addEventListener("click",(()=>{userServices.filterUsers("?permission=true").then((t=>e(t)))})),s.addEventListener("click",(()=>userServices.getUsers().then((t=>e(t)))))})(),(()=>{const t=document.querySelector("#sort-is-children");let r=!0,s="";t.style.cursor="pointer",t.addEventListener("click",(()=>{s=r?"?_sort=children&_order=asc":"?_sort=children&_order=desc",userServices.sortUsers(s).then((t=>e(t))),r=!r}))})(),(()=>{const t=document.querySelector("#search-input"),r=((e,t=300)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout((()=>{e.apply(void 0,s)}),t)}})((()=>{userServices.searchUsers(t.value).then((t=>{e(t)}))}),500);t.addEventListener("input",r)})()})();